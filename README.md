<div align="center">

# ğŸš€ AIFlow

**æ™ºèƒ½ AI ä»»åŠ¡è°ƒåº¦ä¸è·¯ç”±å¹³å°**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

[English](README_EN.md) | ç®€ä½“ä¸­æ–‡

</div>

---

## ğŸ“– ç›®å½•

- [ç®€ä»‹](#-ç®€ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [API ä½¿ç”¨æŒ‡å—](#-api-ä½¿ç”¨æŒ‡å—)
- [æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹](#-æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [æœåŠ¡ç®¡ç†](#-æœåŠ¡ç®¡ç†)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)
- [è®¸å¯è¯](#-è®¸å¯è¯)

---

## ğŸ¯ ç®€ä»‹

**AIFlow** æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ AI ä»»åŠ¡è°ƒåº¦ä¸è·¯ç”±å¹³å°ï¼Œæ—¨åœ¨ç®€åŒ–å¤šæ¨¡å‹ AI æœåŠ¡çš„é›†æˆä¸ç®¡ç†ã€‚é€šè¿‡ç»Ÿä¸€çš„ API ç½‘å…³ï¼Œæ‚¨å¯ä»¥è½»æ¾è°ƒç”¨å„ç§ AI æ¨¡å‹ï¼ˆæ–‡æœ¬ç”Ÿæˆã€å›¾åƒç”Ÿæˆã€è¯­éŸ³è¯†åˆ«ç­‰ï¼‰ï¼Œå¹³å°ä¼šè‡ªåŠ¨å¤„ç†ä»»åŠ¡è°ƒåº¦ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œæ—¥å¿—æ”¶é›†ã€‚

### ğŸŒŸ é€‚ç”¨åœºæ™¯

- ğŸ¤– **å¤šæ¨¡å‹ AI åº”ç”¨** - ç»Ÿä¸€ç®¡ç†å’Œè°ƒç”¨å¤šä¸ª AI æ¨¡å‹æœåŠ¡
- ğŸ”„ **å¼‚æ­¥ä»»åŠ¡å¤„ç†** - æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„ AI æ¨ç†ä»»åŠ¡
- ğŸ“Š **è´Ÿè½½å‡è¡¡** - è‡ªåŠ¨åˆ†é…ä»»åŠ¡åˆ°æœ€ä¼˜çš„æ¨¡å‹å®ä¾‹
- ğŸ”Œ **æœåŠ¡ç¼–æ’** - çµæ´»çš„æœåŠ¡å‘ç°å’ŒåŠ¨æ€æ‰©å±•
- ğŸ“ **é›†ä¸­å¼æ—¥å¿—** - ç»Ÿä¸€æ”¶é›†å’Œç®¡ç†æ‰€æœ‰æœåŠ¡æ—¥å¿—

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¨ ç»Ÿä¸€ API ç½‘å…³
- âœ… RESTful API æ¥å£ï¼Œæ”¯æŒ JSON å’Œ multipart/form-data
- âœ… API Key è®¤è¯æœºåˆ¶
- âœ… è‡ªåŠ¨æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨ï¼ˆMinIOï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å’Œç»“æœè·å–
- âœ… æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥å›è°ƒ

### ğŸ§  æ™ºèƒ½ä»»åŠ¡è°ƒåº¦
- âœ… åŸºäº RabbitMQ çš„æ¶ˆæ¯é˜Ÿåˆ—
- âœ… è‡ªåŠ¨æœåŠ¡å‘ç°ï¼ˆConsulï¼‰
- âœ… è´Ÿè½½æ„ŸçŸ¥çš„å®ä¾‹é€‰æ‹©
- âœ… ä»»åŠ¡è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- âœ… ä¼˜é›…çš„å¤±è´¥å¤„ç†

### ğŸ”Œ å¯æ‰©å±•æ¨¡å‹æ”¯æŒ
- âœ… æ’ä»¶åŒ–æ¨¡å‹æ³¨å†Œæœºåˆ¶
- âœ… æ”¯æŒæ–‡æœ¬ç”Ÿæˆï¼ˆGPT-5 ç­‰ï¼‰
- âœ… æ”¯æŒå›¾åƒç”Ÿæˆï¼ˆStable Diffusion ç­‰ï¼‰
- âœ… æ”¯æŒå›¾åƒç¼–è¾‘ï¼ˆGPT Image-1 ç­‰ï¼‰
- âœ… è½»æ¾æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹æœåŠ¡

### ğŸ“Š å®Œå–„çš„ç›‘æ§ä¸æ—¥å¿—
- âœ… é›†ä¸­å¼æ—¥å¿—æ”¶é›†ï¼ˆPostgreSQLï¼‰
- âœ… å®æ—¶ä»»åŠ¡çŠ¶æ€è¿½è¸ªï¼ˆRedisï¼‰
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… Swagger API æ–‡æ¡£

### ğŸš€ é«˜æ€§èƒ½ä¸å¯é æ€§
- âœ… å¼‚æ­¥ I/Oï¼ˆFastAPI + asyncioï¼‰
- âœ… æ°´å¹³æ‰©å±•æ”¯æŒ
- âœ… å…±äº«å†…å­˜ä¼˜åŒ–ï¼ˆå¤§æ–‡ä»¶ä¼ è¾“ï¼‰
- âœ… ä¼˜é›…çš„å¯åŠ¨å’Œå…³é—­

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·/å®¢æˆ·ç«¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP Request
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway (8000)                        â”‚
â”‚  â€¢ API è®¤è¯  â€¢ ä»»åŠ¡åˆ›å»º  â€¢ çŠ¶æ€æŸ¥è¯¢  â€¢ æ–‡ä»¶ä¸Šä¼              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â†“                  â†“                  â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Redis  â”‚      â”‚ RabbitMQ â”‚      â”‚  MinIO   â”‚
   â”‚ (çŠ¶æ€) â”‚      â”‚ (é˜Ÿåˆ—)   â”‚      â”‚ (å­˜å‚¨)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Task Scheduler (åå°)                       â”‚
â”‚  â€¢ æ¶ˆè´¹ä»»åŠ¡  â€¢ æœåŠ¡å‘ç°  â€¢ è´Ÿè½½å‡è¡¡  â€¢ ä»»åŠ¡åˆ†é…             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Consul  â”‚
                    â”‚ (æœåŠ¡å‘ç°)â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Forwarder-1 â”‚ â”‚  Forwarder-2 â”‚ â”‚  Forwarder-N â”‚
â”‚   (8001)     â”‚ â”‚   (8002)     â”‚ â”‚   (800N)     â”‚
â”‚ â€¢ æ¨¡å‹æ¨ç†   â”‚ â”‚ â€¢ æ¨¡å‹æ¨ç†   â”‚ â”‚ â€¢ æ¨¡å‹æ¨ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ æ—¥å¿—æ¶ˆæ¯
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Log Service (9000)                         â”‚
â”‚  â€¢ æ—¥å¿—æ”¶é›†  â€¢ æ—¥å¿—å­˜å‚¨  â€¢ æ—¥å¿—æŸ¥è¯¢                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚PostgreSQLâ”‚
                    â”‚ (æ—¥å¿—åº“) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | ç«¯å£ | èŒè´£ |
|------|------|------|
| **API Gateway** | 8000 | ç»Ÿä¸€å…¥å£ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œç®¡ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ |
| **Task Scheduler** | - | åå°æœåŠ¡ï¼Œè´Ÿè´£ä»»åŠ¡è°ƒåº¦å’Œè´Ÿè½½å‡è¡¡ |
| **Model Forwarder** | 8001+ | æ¨¡å‹æ¨ç†æœåŠ¡ï¼Œå¯æ°´å¹³æ‰©å±•å¤šä¸ªå®ä¾‹ |
| **Log Service** | 9000 | é›†ä¸­å¼æ—¥å¿—æ”¶é›†å’Œå­˜å‚¨ |

### å¤–éƒ¨ä¾èµ–

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| **Redis** | 6379 | ä»»åŠ¡çŠ¶æ€å­˜å‚¨å’Œç¼“å­˜ |
| **RabbitMQ** | 5672 | ä»»åŠ¡é˜Ÿåˆ—å’Œæ¶ˆæ¯ä¼ é€’ |
| **PostgreSQL** | 5432 | æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨ |
| **Consul** | 8500 | æœåŠ¡æ³¨å†Œä¸å‘ç° |
| **MinIO** | 9000 | å¯¹è±¡å­˜å‚¨ï¼ˆæ–‡ä»¶/å›¾ç‰‡ï¼‰ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Python 3.8+**
- **Docker** (æ¨èç”¨äºè¿è¡Œå¤–éƒ¨æœåŠ¡)
- **Git**

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/xycdaimi/AIFlow.git
cd AIFlow
```

### 2. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. å¯åŠ¨å¤–éƒ¨æœåŠ¡

ä½¿ç”¨ Docker Compose å¿«é€Ÿå¯åŠ¨æ‰€æœ‰å¤–éƒ¨ä¾èµ–ï¼š

```bash
docker-compose up -d
```

æˆ–æ‰‹åŠ¨å¯åŠ¨å„ä¸ªæœåŠ¡ï¼š

```bash
# Redis
docker run -d -p 6379:6379 --name redis redis:latest

# RabbitMQ
docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:management

# PostgreSQL
docker run -d -p 5432:5432 --name postgres \
  -e POSTGRES_USER=admin \
  -e POSTGRES_PASSWORD=admin \
  -e POSTGRES_DB=admin \
  postgres:latest

# Consul
docker run -d -p 8500:8500 --name consul consul:latest

# MinIO
docker run -d -p 9000:9000 -p 9001:9001 --name minio \
  -e MINIO_ROOT_USER=admin \
  -e MINIO_ROOT_PASSWORD=adminadmin \
  minio/minio server /data --console-address ":9001"
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºä½ çš„é…ç½®
# ä¸»è¦é…ç½®é¡¹ï¼š
# - Redis/RabbitMQ/PostgreSQL/Consul/MinIO è¿æ¥ä¿¡æ¯
# - API Gateway API Keys
# - æœåŠ¡ç«¯å£å’Œ URL
```

### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
python scripts/init_database.py
```

### 6. å¯åŠ¨æ‰€æœ‰æœåŠ¡

**Windows:**
```bash
scripts\start_all_services.bat
```

**Linux/Mac:**
```bash
chmod +x scripts/start_all_services.sh
./scripts/start_all_services.sh
```

### 7. éªŒè¯æœåŠ¡çŠ¶æ€

è®¿é—®ä»¥ä¸‹ URL æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

- **API Gateway**: http://localhost:8000/health
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **Model Forwarder**: http://localhost:8001/health
- **Log Service**: http://localhost:8002/health

---

## ğŸ“š API ä½¿ç”¨æŒ‡å—

### è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éœ€è¦åœ¨ Header ä¸­æºå¸¦ API Keyï¼š

```bash
Authorization: Bearer your-api-key
```

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®å…è®¸çš„ API Keysï¼š

```env
API_GATEWAY_API_KEYS=test-key-1,test-key-2,prod-key-abc123
```

### åˆ›å»ºä»»åŠ¡

#### æ–¹å¼ 1: JSON æ ¼å¼ (æ¨è)

```bash
curl -X POST "http://localhost:8000/api/v1/tasks_json" \
  -H "Authorization: Bearer test-key-1" \
  -H "Content-Type: application/json" \
  -d '{
    "task_type": "openai-gpt5",
    "model_spec": {
      "name": "gpt-5",
      "api_key": "sk-your-openai-api-key",
      "endpoint": "https://api.openai.com/v1/chat/completions"
    },
    "payload": {
      "prompt": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†å²"
    },
    "inference_params": {
      "temperature": 0.7,
      "max_tokens": 1000
    }
  }'
```

#### æ–¹å¼ 2: Multipart Form (æ”¯æŒæ–‡ä»¶ä¸Šä¼ )

```bash
curl -X POST "http://localhost:8000/api/v1/tasks_form" \
  -H "Authorization: Bearer test-key-1" \
  -F "task_type=image-generation" \
  -F 'model_spec={"name":"stable-diffusion","api_key":"your-key"}' \
  -F 'payload={"prompt":"a beautiful sunset over mountains"}' \
  -F 'inference_params={"width":1024,"height":768}' \
  -F "files=@/path/to/reference_image.jpg"
```

### å“åº”ç¤ºä¾‹

```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "PENDING",
  "created_at": "2025-11-20T10:30:00Z",
  "message": "Task created successfully"
}
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl -X GET "http://localhost:8000/api/v1/tasks/{task_id}" \
  -H "Authorization: Bearer test-key-1"
```

### å“åº”ç¤ºä¾‹

```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "SUCCESS",
  "task_type": "openai-gpt5",
  "result": {
    "output": {
      "text": "äººå·¥æ™ºèƒ½çš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°..."
    },
    "model": "gpt-5",
    "timestamp": "2025-11-20T10:30:15Z"
  },
  "created_at": "2025-11-20T10:30:00Z",
  "updated_at": "2025-11-20T10:30:15Z"
}
```

### ä»»åŠ¡çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `PENDING` | ä»»åŠ¡å·²åˆ›å»ºï¼Œç­‰å¾…è°ƒåº¦ |
| `PROCESSING` | ä»»åŠ¡æ­£åœ¨å¤„ç†ä¸­ |
| `SUCCESS` | ä»»åŠ¡æˆåŠŸå®Œæˆ |
| `FAILED` | ä»»åŠ¡æ‰§è¡Œå¤±è´¥ |
| `TIMEOUT` | ä»»åŠ¡è¶…æ—¶ |

### Python SDK ç¤ºä¾‹

```python
import httpx
import asyncio

async def create_task():
    api_gateway_url = "http://localhost:8000"
    api_key = "test-key-1"

    task_request = {
        "task_type": "openai-gpt5",
        "model_spec": {
            "name": "gpt-5",
            "api_key": "sk-your-openai-api-key"
        },
        "payload": {
            "prompt": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½"
        },
        "inference_params": {
            "temperature": 0.7
        }
    }

    async with httpx.AsyncClient() as client:
        # åˆ›å»ºä»»åŠ¡
        response = await client.post(
            f"{api_gateway_url}/api/v1/tasks_json",
            json=task_request,
            headers={"Authorization": f"Bearer {api_key}"}
        )
        task = response.json()
        task_id = task["task_id"]
        print(f"Task created: {task_id}")

        # è½®è¯¢ä»»åŠ¡çŠ¶æ€
        while True:
            response = await client.get(
                f"{api_gateway_url}/api/v1/tasks/{task_id}",
                headers={"Authorization": f"Bearer {api_key}"}
            )
            task = response.json()

            if task["status"] in ["SUCCESS", "FAILED", "TIMEOUT"]:
                print(f"Task completed: {task['status']}")
                print(f"Result: {task.get('result')}")
                break

            await asyncio.sleep(2)

asyncio.run(create_task())
```

---

## ğŸ”§ æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹

AIFlow æ”¯æŒé€šè¿‡æ’ä»¶åŒ–æœºåˆ¶è½»æ¾æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹æœåŠ¡ã€‚

### æ­¥éª¤ 1: åˆ›å»ºæ¨¡å‹æœåŠ¡æ–‡ä»¶

åœ¨ `configs/model_services/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ Python æ–‡ä»¶ï¼Œä¾‹å¦‚ `my_custom_model.py`ï¼š

```python
"""My Custom Model Service"""

import httpx
from typing import Dict, Any
from services.model_forwarder.infer import register_inference_function


@register_inference_function("my-custom-model")
def my_custom_model_inference(
    model_spec: Dict[str, Any],
    payload: Dict[str, Any],
    inference_params: Dict[str, Any]
) -> Any:
    """
    è‡ªå®šä¹‰æ¨¡å‹æ¨ç†å‡½æ•°

    Args:
        model_spec: æ¨¡å‹é…ç½®
            - name: æ¨¡å‹åç§°
            - endpoint: API ç«¯ç‚¹
            - api_key: API å¯†é’¥
        payload: è¾“å…¥æ•°æ®
            - input_text: è¾“å…¥æ–‡æœ¬
            - input_image: è¾“å…¥å›¾ç‰‡ URL
        inference_params: æ¨ç†å‚æ•°
            - param1: å‚æ•°1
            - param2: å‚æ•°2

    Returns:
        æ¨ç†ç»“æœï¼ˆä»»æ„æ ¼å¼ï¼‰
    """
    # è·å–é…ç½®
    endpoint = model_spec.get("endpoint")
    api_key = model_spec.get("api_key")

    # è·å–è¾“å…¥
    input_text = payload.get("input_text")

    # è°ƒç”¨æ¨¡å‹ API
    with httpx.Client() as client:
        response = client.post(
            endpoint,
            headers={"Authorization": f"Bearer {api_key}"},
            json={
                "input": input_text,
                **inference_params
            },
            timeout=60.0
        )
        result = response.json()

    # è¿”å›ç»“æœ
    return {
        "output": result["output"],
        "metadata": result.get("metadata", {})
    }
```

### æ­¥éª¤ 2: é‡å¯ Model Forwarder æœåŠ¡

```bash
# Windows
scripts\restart_all_services.bat

# Linux/Mac
./scripts/restart_all_services.sh
```

### æ­¥éª¤ 3: ä½¿ç”¨æ–°æ¨¡å‹

```bash
curl -X POST "http://localhost:8000/api/v1/tasks_json" \
  -H "Authorization: Bearer test-key-1" \
  -H "Content-Type: application/json" \
  -d '{
    "task_type": "my-custom-model",
    "model_spec": {
      "name": "my-model-v1",
      "endpoint": "https://api.example.com/inference",
      "api_key": "your-api-key"
    },
    "payload": {
      "input_text": "Hello, world!"
    },
    "inference_params": {
      "param1": "value1"
    }
  }'
```

### å·²æ”¯æŒçš„æ¨¡å‹

| ä»»åŠ¡ç±»å‹ | è¯´æ˜ | æ–‡ä»¶ |
|---------|------|------|
| `openai-gpt5` | OpenAI GPT-5 æ–‡æœ¬ç”Ÿæˆ | `openai_gpt5.py` |
| `text-generation` | é€šç”¨æ–‡æœ¬ç”Ÿæˆ | `text_generation.py` |
| `image-generation` | å›¾åƒç”Ÿæˆ | `image_generation.py` |
| `gpt-image-1` | GPT Image-1 å›¾åƒç¼–è¾‘ | `gpt_image_1.py` |

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½® (`.env`)

```env
# ==================== Redis é…ç½® ====================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ==================== RabbitMQ é…ç½® ====================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
RABBITMQ_VHOST=/

# ==================== PostgreSQL é…ç½® ====================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin
POSTGRES_DB=admin

# ==================== Consul é…ç½® ====================
CONSUL_HOST=localhost
CONSUL_PORT=8500

# ==================== API Gateway é…ç½® ====================
API_GATEWAY_HOST=0.0.0.0
API_GATEWAY_PORT=8000
API_GATEWAY_URL=http://127.0.0.1:8000
API_GATEWAY_INTERNAL_KEY=your-secret-internal-key
API_GATEWAY_API_KEYS=test-key-1,test-key-2,prod-key-abc123

# ==================== Task Scheduler é…ç½® ====================
SCHEDULER_INSTANCE_ID=scheduler-001
SCHEDULER_MAX_PENDING_TASKS=2
SCHEDULER_RETRY_DELAY=2

# ==================== Model Forwarder é…ç½® ====================
FORWARDER_INSTANCE_ID=forwarder-001
FORWARDER_SERVICE_HOST=0.0.0.0
FORWARDER_SERVICE_PORT=8001
FORWARDER_SERVICE_URL=http://127.0.0.1:8001

# ==================== Log Service é…ç½® ====================
LOG_BATCH_SIZE=100
LOG_BATCH_TIMEOUT=5
LOG_SERVICE_HOST=0.0.0.0
LOG_SERVICE_PORT=8002

# ==================== ä»»åŠ¡é…ç½® ====================
TASK_TTL=86400              # ä»»åŠ¡ TTL (24å°æ—¶)
TASK_TIMEOUT=300            # ä»»åŠ¡è¶…æ—¶ (5åˆ†é’Ÿ)
TASK_MAX_RETRIES=3          # æœ€å¤§é‡è¯•æ¬¡æ•°
TASK_MAX_WAIT_TIME=120      # æœ€å¤§ç­‰å¾…æ—¶é—´ (2åˆ†é’Ÿ)
TASK_MONITOR_INTERVAL=30    # ç›‘æ§é—´éš” (30ç§’)

# ==================== MinIO é…ç½® ====================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=admin
MINIO_SECRET_KEY=adminadmin
MINIO_SECURE=false
MINIO_BUCKET_INPUTS=ai-route-inputs
MINIO_BUCKET_OUTPUTS=ai-route-outputs

# ==================== åª’ä½“å¤„ç†é…ç½® ====================
MEDIA_MAX_DOWNLOAD_SIZE=104857600  # 100MB
MEDIA_DOWNLOAD_TIMEOUT=60
MEDIA_MAX_FILE_SIZE=104857600      # 100MB
```

### é…ç½®é¡¹è¯´æ˜

è¯¦ç»†çš„é…ç½®è¯´æ˜è¯·å‚è€ƒ [é…ç½®æ–‡æ¡£](docs/configuration.md)ã€‚

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# Windows
scripts\start_all_services.bat

# Linux/Mac
./scripts/start_all_services.sh
```

### åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
# Windows
scripts\stop_all_services.bat

# Linux/Mac
./scripts/stop_all_services.sh
```

### é‡å¯æ‰€æœ‰æœåŠ¡

```bash
# Windows
scripts\restart_all_services.bat

# Linux/Mac
./scripts/restart_all_services.sh
```

### å•ç‹¬å¯åŠ¨æœåŠ¡

```bash
# API Gateway
python -m services.api_gateway.main

# Task Scheduler
python -m services.task_scheduler.main

# Model Forwarder
python -m services.model_forwarder.main

# Log Service
python -m services.log_service.main
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½äº `logs/` ç›®å½•ï¼š

```bash
# API Gateway æ—¥å¿—
tail -f logs/api_gateway.log

# Task Scheduler æ—¥å¿—
tail -f logs/task_scheduler.log

# Model Forwarder æ—¥å¿—
tail -f logs/model_forwarder.log

# Log Service æ—¥å¿—
tail -f logs/log_service.log
```

---

## ğŸ‘¨â€ğŸ’» å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
AIFlow/
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ model_services/         # æ¨¡å‹æœåŠ¡æ’ä»¶
â”‚   â””â”€â”€ workflows/              # å·¥ä½œæµé…ç½®
â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ logger.py               # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ protocols.py            # åè®®å®šä¹‰
â”‚   â”œâ”€â”€ utils.py                # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ storage/                # å­˜å‚¨å®¢æˆ·ç«¯
â”œâ”€â”€ services/                   # æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ api_gateway/            # API ç½‘å…³
â”‚   â”œâ”€â”€ task_scheduler/         # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”œâ”€â”€ model_forwarder/        # æ¨¡å‹è½¬å‘æœåŠ¡
â”‚   â””â”€â”€ log_service/            # æ—¥å¿—æœåŠ¡
â”œâ”€â”€ scripts/                    # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ init_database.py        # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ start_all_services.bat  # å¯åŠ¨è„šæœ¬ (Windows)
â”‚   â””â”€â”€ start_all_services.sh   # å¯åŠ¨è„šæœ¬ (Linux/Mac)
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ docker-compose.yml          # Docker Compose é…ç½®
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_api_authentication.py

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=services --cov-report=html
```

### ä»£ç è§„èŒƒ

é¡¹ç›®éµå¾ª PEP 8 ä»£ç è§„èŒƒï¼Œä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œä»£ç æ£€æŸ¥ï¼š

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements-dev.txt

# ä»£ç æ ¼å¼åŒ–
black .

# ä»£ç æ£€æŸ¥
flake8 .

# ç±»å‹æ£€æŸ¥
mypy .
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

**é—®é¢˜**: æœåŠ¡å¯åŠ¨æ—¶æŠ¥é”™ "Connection refused"

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥å¤–éƒ¨æœåŠ¡ï¼ˆRedisã€RabbitMQ ç­‰ï¼‰æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥ `.env` é…ç½®æ–‡ä»¶ä¸­çš„è¿æ¥ä¿¡æ¯æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨

### 2. ä»»åŠ¡ä¸€ç›´å¤„äº PENDING çŠ¶æ€

**é—®é¢˜**: æäº¤çš„ä»»åŠ¡é•¿æ—¶é—´å¤„äº PENDING çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ Task Scheduler æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥ Model Forwarder æœåŠ¡æ˜¯å¦å·²æ³¨å†Œåˆ° Consul
- æ£€æŸ¥ RabbitMQ é˜Ÿåˆ—æ˜¯å¦æœ‰æ¶ˆæ¯å †ç§¯

### 3. æ¨¡å‹æ¨ç†å¤±è´¥

**é—®é¢˜**: ä»»åŠ¡çŠ¶æ€å˜ä¸º FAILED

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ¨¡å‹ API Key æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ¨¡å‹ API ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®
- æŸ¥çœ‹ Model Forwarder æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**é—®é¢˜**: ä¸Šä¼ æ–‡ä»¶æ—¶æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ MinIO æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼ˆé»˜è®¤ 100MBï¼‰
- æ£€æŸ¥ MinIO å­˜å‚¨æ¡¶æ˜¯å¦å·²åˆ›å»º

æ›´å¤šé—®é¢˜è¯·æŸ¥çœ‹ [FAQ æ–‡æ¡£](docs/faq.md) æˆ–æäº¤ [Issue](https://github.com/yourusername/AIFlow/issues)ã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### å¦‚ä½•è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

### è´¡çŒ®ç±»å‹

- ğŸ› æŠ¥å‘Š Bug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“ æ”¹è¿›æ–‡æ¡£
- ğŸ”§ æäº¤ä»£ç ä¿®å¤
- âœ¨ æ·»åŠ æ–°åŠŸèƒ½

### å¼€å‘æµç¨‹

1. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. éµå¾ªä»£ç è§„èŒƒ
3. æ·»åŠ å¿…è¦çš„æµ‹è¯•ç”¨ä¾‹
4. æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„ Web æ¡†æ¶
- [RabbitMQ](https://www.rabbitmq.com/) - æ¶ˆæ¯é˜Ÿåˆ—
- [Redis](https://redis.io/) - å†…å­˜æ•°æ®åº“
- [Consul](https://www.consul.io/) - æœåŠ¡å‘ç°
- [MinIO](https://min.io/) - å¯¹è±¡å­˜å‚¨
- [PostgreSQL](https://www.postgresql.org/) - å…³ç³»å‹æ•°æ®åº“

---

## ğŸ“ è”ç³»æˆ‘ä»¬

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/xycdaimi/AIFlow
- **é—®é¢˜åé¦ˆ**: https://github.com/xycdaimi/AIFlow/issues
- **é‚®ç®±**: xycdaimi@gmail.com

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼â­**

Made with â¤ï¸ by AIFlow Team

</div>
